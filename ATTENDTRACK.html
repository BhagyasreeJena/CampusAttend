<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>College Attendance System</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#f5f4f0;
  --bg2:#eceae4;
  --surface:#ffffff;
  --surface2:#f9f8f5;
  --border:#e2dfd6;
  --border2:#d5d1c7;
  --ink:#1a1916;
  --ink2:#3d3b35;
  --muted:#888070;
  --accent:#1a3cff;
  --accent-bg:#eef0ff;
  --present:#0a7c5c;
  --present-bg:#e8f7f2;
  --absent:#c0392b;
  --absent-bg:#fdf0ef;
  --late:#b85e00;
  --late-bg:#fef4e8;
  --medical:#6b3fa0;
  --medical-bg:#f3eeff;
  --shadow:0 2px 12px rgba(0,0,0,.07);
  --shadow-lg:0 8px 32px rgba(0,0,0,.1);
}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--ink);min-height:100vh;}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.shell{display:flex;min-height:100vh;}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar{
  width:260px;flex-shrink:0;
  background:var(--ink);
  display:flex;flex-direction:column;
  padding:0;
  position:sticky;top:0;height:100vh;
  overflow-y:auto;
}
.sidebar-brand{
  padding:28px 24px 20px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.brand-badge{
  width:40px;height:40px;border-radius:10px;
  background:var(--accent);
  display:flex;align-items:center;justify-content:center;
  font-size:18px;font-weight:800;color:#fff;
  margin-bottom:12px;
}
.brand-name{font-size:17px;font-weight:700;color:#fff;letter-spacing:-.3px;}
.brand-sub{font-size:11px;color:rgba(255,255,255,.4);font-family:'JetBrains Mono',monospace;margin-top:2px;}

.sidebar-section{padding:20px 16px 8px;}
.sidebar-label{font-size:10px;text-transform:uppercase;letter-spacing:2px;color:rgba(255,255,255,.3);font-weight:600;padding:0 8px;margin-bottom:6px;}
.nav-item{
  display:flex;align-items:center;gap:10px;
  padding:9px 12px;border-radius:8px;
  font-size:13px;font-weight:500;color:rgba(255,255,255,.55);
  cursor:pointer;transition:all .15s;margin-bottom:2px;
  border:none;background:transparent;width:100%;text-align:left;
}
.nav-item:hover{background:rgba(255,255,255,.07);color:rgba(255,255,255,.85);}
.nav-item.active{background:var(--accent);color:#fff;}
.nav-item .nav-icon{width:18px;text-align:center;font-size:14px;}
.nav-badge{margin-left:auto;background:rgba(255,255,255,.15);font-size:10px;padding:2px 7px;border-radius:99px;font-family:'JetBrains Mono',monospace;}
.nav-item.active .nav-badge{background:rgba(255,255,255,.25);}

.subject-list{padding:0 16px 16px;}
.subject-item{
  display:flex;align-items:center;gap:10px;
  padding:8px 12px;border-radius:8px;
  font-size:12px;color:rgba(255,255,255,.5);
  cursor:pointer;transition:all .15s;margin-bottom:1px;
  border:none;background:transparent;width:100%;text-align:left;
}
.subject-item:hover{background:rgba(255,255,255,.06);color:rgba(255,255,255,.8);}
.subject-item.active{background:rgba(255,255,255,.1);color:#fff;}
.sub-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.sub-name{font-weight:500;flex:1;}
.sub-code{font-family:'JetBrains Mono',monospace;font-size:10px;color:rgba(255,255,255,.3);}

.sidebar-footer{
  margin-top:auto;padding:16px;
  border-top:1px solid rgba(255,255,255,.08);
}
.semester-badge{
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.1);
  border-radius:10px;padding:10px 14px;
  font-size:12px;color:rgba(255,255,255,.6);
}
.semester-badge strong{display:block;color:#fff;font-size:13px;margin-bottom:2px;}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main{flex:1;overflow-x:hidden;}
.topbar{
  background:var(--surface);
  border-bottom:1px solid var(--border);
  padding:0 32px;
  height:64px;
  display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;z-index:10;
}
.topbar-left h2{font-size:18px;font-weight:700;color:var(--ink);}
.topbar-left p{font-size:12px;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-top:1px;}
.topbar-right{display:flex;align-items:center;gap:10px;}

.btn{
  padding:8px 18px;border-radius:8px;
  font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;
  cursor:pointer;border:none;transition:all .15s;white-space:nowrap;
}
.btn-primary{background:var(--accent);color:#fff;}
.btn-primary:hover{background:#1230e0;transform:translateY(-1px);}
.btn-outline{background:transparent;color:var(--ink2);border:1.5px solid var(--border2);}
.btn-outline:hover{border-color:var(--accent);color:var(--accent);}
.btn-sm{padding:6px 14px;font-size:12px;}
.btn-danger{background:var(--absent-bg);color:var(--absent);border:1.5px solid #f0bfbb;}
.btn-danger:hover{background:var(--absent);color:#fff;}
.btn-export{background:var(--ink);color:#fff;}
.btn-export:hover{background:#333;}

.content{padding:28px 32px;}

/* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
.stats-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:28px;}
.stat-card{
  background:var(--surface);
  border:1.5px solid var(--border);
  border-radius:14px;padding:18px 20px;
  transition:all .2s;cursor:default;
}
.stat-card:hover{border-color:var(--accent);box-shadow:var(--shadow);}
.stat-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.stat-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:15px;}
.stat-trend{font-size:10px;font-family:'JetBrains Mono',monospace;padding:3px 8px;border-radius:99px;}
.stat-val{font-size:32px;font-weight:800;line-height:1;letter-spacing:-1px;}
.stat-lbl{font-size:11px;color:var(--muted);margin-top:5px;font-weight:500;}

/* ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ */
.controls{
  background:var(--surface);border:1.5px solid var(--border);
  border-radius:14px;padding:16px 20px;
  display:flex;gap:12px;flex-wrap:wrap;align-items:center;
  margin-bottom:22px;
}
.ctrl-input{
  background:var(--surface2);border:1.5px solid var(--border);
  color:var(--ink);font-family:'Outfit',sans-serif;font-size:13px;
  padding:8px 14px;border-radius:8px;outline:none;
  transition:border-color .15s;
}
.ctrl-input:focus{border-color:var(--accent);}
.ctrl-input[type="text"]{flex:1;min-width:180px;}
.ctrl-input[type="date"]{font-family:'JetBrains Mono',monospace;font-size:12px;}
.ctrl-sep{width:1px;height:28px;background:var(--border);flex-shrink:0;}
.quick-mark{display:flex;gap:6px;align-items:center;}
.qm-btn{
  padding:6px 12px;border-radius:7px;font-size:11px;font-weight:700;
  font-family:'Outfit',sans-serif;cursor:pointer;border:1.5px solid;
  transition:all .15s;
}
.qm-p{border-color:var(--present);color:var(--present);background:var(--present-bg);}
.qm-p:hover{background:var(--present);color:#fff;}
.qm-a{border-color:var(--absent);color:var(--absent);background:var(--absent-bg);}
.qm-a:hover{background:var(--absent);color:#fff;}

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.table-card{
  background:var(--surface);border:1.5px solid var(--border);
  border-radius:16px;overflow:hidden;margin-bottom:24px;
}
.table-head-bar{
  display:flex;align-items:center;justify-content:space-between;
  padding:16px 22px;border-bottom:1px solid var(--border);
}
.table-head-bar h3{font-size:15px;font-weight:700;}
.table-head-bar p{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-top:2px;}
.tbl-actions{display:flex;gap:8px;}

table{width:100%;border-collapse:collapse;}
thead{background:var(--surface2);}
thead th{
  padding:11px 18px;text-align:left;
  font-size:10px;text-transform:uppercase;letter-spacing:1.8px;
  color:var(--muted);font-weight:600;font-family:'JetBrains Mono',monospace;
}
thead th:first-child{padding-left:22px;}
tbody tr{border-bottom:1px solid var(--border);transition:background .12s;}
tbody tr:last-child{border-bottom:none;}
tbody tr:hover{background:var(--surface2);}
tbody td{padding:13px 18px;font-size:13px;vertical-align:middle;}
tbody td:first-child{padding-left:22px;}

/* Avatar */
.stu-cell{display:flex;align-items:center;gap:12px;}
.stu-av{
  width:36px;height:36px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:13px;font-weight:700;flex-shrink:0;
}
.stu-name{font-weight:600;font-size:13px;color:var(--ink);}
.stu-id{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-top:1px;}

/* Dept pill */
.dept-pill{
  display:inline-flex;align-items:center;gap:5px;
  padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;
  border:1.5px solid;
}

/* Status buttons */
.status-grp{display:inline-flex;border-radius:8px;overflow:hidden;border:1.5px solid var(--border);background:var(--surface2);}
.st-btn{
  border:none;background:transparent;
  padding:5px 10px;font-size:10px;font-weight:700;
  font-family:'Outfit',sans-serif;cursor:pointer;color:var(--muted);
  letter-spacing:.3px;transition:all .12s;
}
.st-btn:hover{background:rgba(0,0,0,.05);}
.st-btn.sp{background:var(--present-bg);color:var(--present);}
.st-btn.sa{background:var(--absent-bg);color:var(--absent);}
.st-btn.sl{background:var(--late-bg);color:var(--late);}
.st-btn.sm{background:var(--medical-bg);color:var(--medical);}

/* Attendance bar */
.att-bar-wrap{display:flex;align-items:center;gap:8px;}
.att-track{flex:1;height:5px;background:var(--bg2);border-radius:99px;overflow:hidden;min-width:50px;}
.att-fill{height:100%;border-radius:99px;transition:width .4s;}
.att-fill.hi{background:var(--present);}
.att-fill.md{background:var(--late);}
.att-fill.lo{background:var(--absent);}
.att-pct{font-size:12px;font-family:'JetBrains Mono',monospace;color:var(--muted);min-width:34px;}
.att-warn{font-size:10px;color:var(--absent);font-weight:600;background:var(--absent-bg);padding:2px 7px;border-radius:4px;}

/* Shortfall */
.shortfall{
  background:var(--absent-bg);border:1.5px solid #f0bfbb;
  border-radius:10px;padding:6px 12px;
  font-size:11px;color:var(--absent);font-weight:600;
}
.shortfall.ok{background:var(--present-bg);border-color:#9edecf;color:var(--present);}

/* icon btn */
.icon-btn{
  width:28px;height:28px;border-radius:6px;
  background:transparent;border:1.5px solid var(--border);
  color:var(--muted);cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  font-size:13px;transition:all .12s;
}
.icon-btn:hover{border-color:var(--absent);color:var(--absent);background:var(--absent-bg);}

/* ‚îÄ‚îÄ SUBJECT ANALYTICS PANEL ‚îÄ‚îÄ */
.analytics{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px;}
.panel{
  background:var(--surface);border:1.5px solid var(--border);
  border-radius:16px;padding:22px;
}
.panel-title{font-size:14px;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px;}
.panel-title span{font-size:16px;}

.subject-rows .s-row{
  display:flex;align-items:center;gap:12px;
  padding:10px 0;border-bottom:1px solid var(--border);
}
.subject-rows .s-row:last-child{border-bottom:none;}
.s-dot{width:10px;height:10px;border-radius:3px;flex-shrink:0;}
.s-info{flex:1;}
.s-name{font-size:13px;font-weight:600;}
.s-meta{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-top:1px;}
.s-bar-wrap{flex:1;}
.s-track{height:6px;background:var(--bg2);border-radius:99px;overflow:hidden;}
.s-fill{height:100%;border-radius:99px;}
.s-pct{font-size:12px;font-family:'JetBrains Mono',monospace;color:var(--muted);min-width:34px;text-align:right;}

.risk-list .r-row{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:10px 0;border-bottom:1px solid var(--border);
}
.risk-list .r-row:last-child{border-bottom:none;}
.r-name{font-size:13px;font-weight:600;}
.r-sub{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-top:1px;}
.r-badge{font-size:11px;font-weight:700;padding:3px 9px;border-radius:6px;}
.r-badge.danger{background:var(--absent-bg);color:var(--absent);}
.r-badge.warn  {background:var(--late-bg);color:var(--late);}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.overlay{
  position:fixed;inset:0;background:rgba(20,20,18,.55);
  backdrop-filter:blur(6px);z-index:100;
  display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity .2s;
}
.overlay.open{opacity:1;pointer-events:all;}
.modal{
  background:var(--surface);border:1.5px solid var(--border);
  border-radius:20px;padding:32px;width:480px;max-width:95vw;
  box-shadow:var(--shadow-lg);
  transform:translateY(16px);transition:transform .2s;
}
.overlay.open .modal{transform:translateY(0);}
.modal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;}
.modal-head h3{font-size:18px;font-weight:800;}
.modal-close{background:var(--surface2);border:1.5px solid var(--border);border-radius:8px;width:32px;height:32px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .12s;}
.modal-close:hover{background:var(--absent-bg);border-color:var(--absent);color:var(--absent);}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.form-grid .full{grid-column:1/-1;}
.fg{display:flex;flex-direction:column;gap:6px;}
.fg label{font-size:11px;text-transform:uppercase;letter-spacing:1.2px;color:var(--muted);font-family:'JetBrains Mono',monospace;font-weight:500;}
.fg input,.fg select{
  background:var(--surface2);border:1.5px solid var(--border);
  color:var(--ink);font-family:'Outfit',sans-serif;font-size:14px;
  padding:9px 13px;border-radius:9px;outline:none;transition:border-color .15s;
}
.fg input:focus,.fg select:focus{border-color:var(--accent);}
.modal-foot{display:flex;gap:10px;margin-top:24px;}
.modal-foot .btn{flex:1;text-align:center;padding:10px;}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{
  position:fixed;bottom:24px;right:24px;
  background:var(--ink);color:#fff;
  border-radius:12px;padding:13px 20px;
  font-size:13px;font-weight:600;z-index:200;
  transform:translateY(80px);opacity:0;
  transition:all .3s;pointer-events:none;
  display:flex;align-items:center;gap:10px;
  box-shadow:var(--shadow-lg);
}
.toast.show{transform:translateY(0);opacity:1;}
.toast.ok {border-left:4px solid var(--present);}
.toast.err{border-left:4px solid var(--absent);}
.toast.info{border-left:4px solid var(--accent);}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:900px){
  .sidebar{display:none;}
  .stats-grid{grid-template-columns:repeat(3,1fr);}
  .analytics{grid-template-columns:1fr;}
  .content{padding:20px 16px;}
  .topbar{padding:0 16px;}
}
@media(max-width:600px){
  .stats-grid{grid-template-columns:repeat(2,1fr);}
  tbody td:nth-child(3),thead th:nth-child(3),
  tbody td:nth-child(6),thead th:nth-child(6){display:none;}
}

/* page-in animation */
@keyframes fadeUp{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}
.stat-card{animation:fadeUp .4s ease both;}
.stat-card:nth-child(1){animation-delay:.05s}
.stat-card:nth-child(2){animation-delay:.1s}
.stat-card:nth-child(3){animation-delay:.15s}
.stat-card:nth-child(4){animation-delay:.2s}
.stat-card:nth-child(5){animation-delay:.25s}
.table-card{animation:fadeUp .4s .2s ease both;}
.analytics{animation:fadeUp .4s .3s ease both;}
</style>
</head>
<body>
<div class="shell">

  <!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
  <aside class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-badge">C</div>
      <div class="brand-name">CampusAttend</div>
      <div class="brand-sub">// Faculty Portal</div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-label">Menu</div>
      <button class="nav-item active"><span class="nav-icon">üìã</span> Attendance <span class="nav-badge" id="nb-total">0</span></button>
      <button class="nav-item"><span class="nav-icon">üìä</span> Reports</button>
      <button class="nav-item"><span class="nav-icon">‚ö†Ô∏è</span> Low Attendance <span class="nav-badge" id="nb-risk">0</span></button>
      <button class="nav-item"><span class="nav-icon">üë•</span> Students</button>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-label">Subjects</div>
    </div>
    <div class="subject-list" id="subjectList"></div>

    <div class="sidebar-footer">
      <div class="semester-badge">
        <strong id="semLabel">Semester V ¬∑ 2024‚Äì25</strong>
        <span id="todayLabel"></span>
      </div>
    </div>
  </aside>

  <!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ -->
  <div class="main">
    <div class="topbar">
      <div class="topbar-left">
        <h2 id="pageTitle">Attendance Register</h2>
        <p id="pageSubtitle">Loading‚Ä¶</p>
      </div>
      <div class="topbar-right">
        <button class="btn btn-outline btn-sm" onclick="openModal()">+ Add Student</button>
        <button class="btn btn-export btn-sm" onclick="exportCSV()">‚Üì Export CSV</button>
      </div>
    </div>

    <div class="content">

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-top">
            <div class="stat-icon" style="background:#eef0ff;font-size:16px;">üë•</div>
            <span class="stat-trend" style="background:#eef0ff;color:var(--accent)">Total</span>
          </div>
          <div class="stat-val" id="stTotal" style="color:var(--accent)">0</div>
          <div class="stat-lbl">Enrolled Students</div>
        </div>
        <div class="stat-card">
          <div class="stat-top">
            <div class="stat-icon" style="background:var(--present-bg)">‚úÖ</div>
            <span class="stat-trend" style="background:var(--present-bg);color:var(--present)" id="stPresentPct">‚Äì</span>
          </div>
          <div class="stat-val" id="stPresent" style="color:var(--present)">0</div>
          <div class="stat-lbl">Present Today</div>
        </div>
        <div class="stat-card">
          <div class="stat-top">
            <div class="stat-icon" style="background:var(--absent-bg)">‚ùå</div>
            <span class="stat-trend" style="background:var(--absent-bg);color:var(--absent)" id="stAbsentPct">‚Äì</span>
          </div>
          <div class="stat-val" id="stAbsent" style="color:var(--absent)">0</div>
          <div class="stat-lbl">Absent Today</div>
        </div>
        <div class="stat-card">
          <div class="stat-top">
            <div class="stat-icon" style="background:var(--late-bg)">‚è∞</div>
            <span class="stat-trend" style="background:var(--late-bg);color:var(--late)" id="stLatePct">‚Äì</span>
          </div>
          <div class="stat-val" id="stLate" style="color:var(--late)">0</div>
          <div class="stat-lbl">Late / OD</div>
        </div>
        <div class="stat-card">
          <div class="stat-top">
            <div class="stat-icon" style="background:var(--medical-bg)">üè•</div>
            <span class="stat-trend" style="background:var(--medical-bg);color:var(--medical)" id="stMedPct">‚Äì</span>
          </div>
          <div class="stat-val" id="stMed" style="color:var(--medical)">0</div>
          <div class="stat-lbl">Medical Leave</div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <input type="text" class="ctrl-input" id="searchInput" placeholder="üîç  Search by name or USN‚Ä¶"/>
        <input type="date" class="ctrl-input" id="dateInput"/>
        <select class="ctrl-input" id="deptFilter">
          <option value="">All Departments</option>
          <option value="CSE">CSE</option>
          <option value="ECE">ECE</option>
          <option value="ME">Mech Engg</option>
          <option value="CE">Civil Engg</option>
          <option value="MBA">MBA</option>
          <option value="MCA">MCA</option>
        </select>
        <select class="ctrl-input" id="subjectFilter" onchange="filterBySubject()">
          <option value="">All Subjects</option>
        </select>
        <div class="ctrl-sep"></div>
        <div class="quick-mark">
          <span style="font-size:11px;color:var(--muted);font-weight:600">Quick:</span>
          <button class="qm-btn qm-p" onclick="markAll('P')">All Present</button>
          <button class="qm-btn qm-a" onclick="markAll('A')">All Absent</button>
        </div>
      </div>

      <!-- Table -->
      <div class="table-card">
        <div class="table-head-bar">
          <div>
            <h3 id="tableTitle">All Students</h3>
            <p id="tableSubtitle">‚Äî</p>
          </div>
          <div class="tbl-actions">
            <span style="font-size:12px;color:var(--muted);font-family:'JetBrains Mono',monospace;align-self:center" id="minReq">Min. Required: <strong style="color:var(--absent)">75%</strong></span>
          </div>
        </div>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Student</th>
              <th>Dept / Sem</th>
              <th>Subject</th>
              <th>Attendance %</th>
              <th>Classes Left to Bunk</th>
              <th>Today's Status</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>

      <!-- Analytics -->
      <div class="analytics">
        <div class="panel">
          <div class="panel-title"><span>üìö</span> Subject-wise Attendance</div>
          <div class="subject-rows" id="subjectAnalytics"></div>
        </div>
        <div class="panel">
          <div class="panel-title"><span>‚ö†Ô∏è</span> Students at Risk (&lt;75%)</div>
          <div class="risk-list" id="riskList"></div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Modal -->
<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modal-head">
      <h3>Add New Student</h3>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="form-grid">
      <div class="fg full">
        <label>Full Name</label>
        <input type="text" id="mName" placeholder="e.g. Arjun Kumar Reddy"/>
      </div>
      <div class="fg">
        <label>USN / Roll No.</label>
        <input type="text" id="mUSN" placeholder="e.g. 1BM21CS042"/>
      </div>
      <div class="fg">
        <label>Department</label>
        <select id="mDept">
          <option value="CSE">CSE</option>
          <option value="ECE">ECE</option>
          <option value="ME">Mech Engg</option>
          <option value="CE">Civil Engg</option>
          <option value="MBA">MBA</option>
          <option value="MCA">MCA</option>
        </select>
      </div>
      <div class="fg">
        <label>Semester</label>
        <select id="mSem">
          <option value="1">Sem I</option>
          <option value="2">Sem II</option>
          <option value="3">Sem III</option>
          <option value="4">Sem IV</option>
          <option value="5" selected>Sem V</option>
          <option value="6">Sem VI</option>
          <option value="7">Sem VII</option>
          <option value="8">Sem VIII</option>
        </select>
      </div>
      <div class="fg full">
        <label>Subject</label>
        <select id="mSubject">
          <option value="DS">Data Structures (DS)</option>
          <option value="DBMS">Database Management (DBMS)</option>
          <option value="CN">Computer Networks (CN)</option>
          <option value="OS">Operating Systems (OS)</option>
          <option value="SE">Software Engineering (SE)</option>
          <option value="MATH">Engineering Maths (MATH)</option>
          <option value="PHY">Engineering Physics (PHY)</option>
          <option value="MBA-FM">Financial Management (MBA-FM)</option>
          <option value="MCA-AI">Artificial Intelligence (MCA-AI)</option>
        </select>
      </div>
      <div class="fg">
        <label>Total Classes Held</label>
        <input type="number" id="mTotal" value="40" min="1"/>
      </div>
      <div class="fg">
        <label>Classes Attended</label>
        <input type="number" id="mAttended" value="35" min="0"/>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="addStudent()">Add Student</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUBJECTS = [
  { id:'DS',     name:'Data Structures',       code:'21CS42', color:'#1a3cff', bg:'#eef0ff', dept:'CSE' },
  { id:'DBMS',   name:'Database Management',   code:'21CS43', color:'#0a7c5c', bg:'#e8f7f2', dept:'CSE' },
  { id:'CN',     name:'Computer Networks',     code:'21CS44', color:'#b85e00', bg:'#fef4e8', dept:'CSE' },
  { id:'OS',     name:'Operating Systems',     code:'21CS45', color:'#6b3fa0', bg:'#f3eeff', dept:'CSE' },
  { id:'SE',     name:'Software Engineering',  code:'21CS46', color:'#c0392b', bg:'#fdf0ef', dept:'CSE' },
  { id:'MATH',   name:'Engineering Maths',     code:'21MAT41', color:'#1a6e9e', bg:'#e8f3fb', dept:'All' },
  { id:'PHY',    name:'Engineering Physics',   code:'21PHY11', color:'#4a7c00', bg:'#f0f9e4', dept:'ECE' },
  { id:'MBA-FM', name:'Financial Management',  code:'21MBA31', color:'#8b4500', bg:'#fff2e5', dept:'MBA' },
  { id:'MCA-AI', name:'Artificial Intelligence',code:'21MCA41',color:'#005b8e', bg:'#e5f3ff', dept:'MCA' },
];

const DEPT_COLORS = {
  CSE:'#1a3cff',ECE:'#0a7c5c',ME:'#b85e00',CE:'#4a7c00',MBA:'#8b4500',MCA:'#005b8e'
};
const DEPT_BG = {
  CSE:'#eef0ff',ECE:'#e8f7f2',ME:'#fef4e8',CE:'#f0f9e4',MBA:'#fff2e5',MCA:'#e5f3ff'
};
const AV_COLORS = ['#1a3cff','#0a7c5c','#b85e00','#6b3fa0','#c0392b','#1a6e9e','#4a7c00'];

let nextId = 21;
let students = [
  {id:1, name:'Arjun Kumar Reddy',   usn:'1BM21CS001', dept:'CSE', sem:5, subject:'DS',     total:60, attended:54, status:'P'},
  {id:2, name:'Sneha Iyer',          usn:'1BM21CS002', dept:'CSE', sem:5, subject:'DS',     total:60, attended:40, status:'A'},
  {id:3, name:'Vikram Nair',         usn:'1BM21CS003', dept:'CSE', sem:5, subject:'DBMS',   total:55, attended:52, status:'P'},
  {id:4, name:'Priya Venkatesh',     usn:'1BM21CS004', dept:'CSE', sem:5, subject:'DBMS',   total:55, attended:38, status:'L'},
  {id:5, name:'Rohit Sharma',        usn:'1BM21CS005', dept:'CSE', sem:5, subject:'CN',     total:58, attended:50, status:'P'},
  {id:6, name:'Ananya Das',          usn:'1BM21CS006', dept:'CSE', sem:5, subject:'CN',     total:58, attended:42, status:'P'},
  {id:7, name:'Karan Mehta',         usn:'1BM21CS007', dept:'CSE', sem:5, subject:'OS',     total:60, attended:44, status:'M'},
  {id:8, name:'Divya Krishnamurthy', usn:'1BM21CS008', dept:'CSE', sem:5, subject:'OS',     total:60, attended:57, status:'P'},
  {id:9, name:'Aditya Bose',         usn:'1BM21ECE001',dept:'ECE', sem:5, subject:'PHY',    total:50, attended:35, status:'A'},
  {id:10,name:'Pooja Pillai',        usn:'1BM21ECE002',dept:'ECE', sem:5, subject:'PHY',    total:50, attended:48, status:'P'},
  {id:11,name:'Suresh Babu',         usn:'1BM21ME001', dept:'ME',  sem:3, subject:'MATH',   total:45, attended:32, status:'A'},
  {id:12,name:'Deepika Rao',         usn:'1BM21ME002', dept:'ME',  sem:3, subject:'MATH',   total:45, attended:40, status:'P'},
  {id:13,name:'Mohammed Imran',      usn:'1BM21MBA001',dept:'MBA', sem:1, subject:'MBA-FM',  total:40, attended:38, status:'P'},
  {id:14,name:'Lakshmi Priya',       usn:'1BM21MBA002',dept:'MBA', sem:1, subject:'MBA-FM',  total:40, attended:28, status:'L'},
  {id:15,name:'Rahul Gupta',         usn:'1BM21MCA001',dept:'MCA', sem:5, subject:'MCA-AI', total:52, attended:46, status:'P'},
  {id:16,name:'Swati Joshi',         usn:'1BM21MCA002',dept:'MCA', sem:5, subject:'MCA-AI', total:52, attended:39, status:'P'},
  {id:17,name:'Naveen Kumar',        usn:'1BM21CS009', dept:'CSE', sem:5, subject:'SE',     total:56, attended:41, status:'A'},
  {id:18,name:'Kavitha Subramanian', usn:'1BM21CS010', dept:'CSE', sem:5, subject:'SE',     total:56, attended:53, status:'P'},
  {id:19,name:'Harish Patil',        usn:'1BM21CE001', dept:'CE',  sem:5, subject:'MATH',   total:45, attended:30, status:'A'},
  {id:20,name:'Ritu Agarwal',        usn:'1BM21CE002', dept:'CE',  sem:5, subject:'MATH',   total:45, attended:44, status:'P'},
];

function pct(s){ return s.total ? Math.round(s.attended/s.total*100) : 0; }
function avColor(id){ return AV_COLORS[id % AV_COLORS.length]; }
function initials(n){ return n.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2); }
function subjectById(id){ return SUBJECTS.find(s=>s.id===id)||SUBJECTS[0]; }

// How many more classes they can miss and still stay at 75%
// Formula: if attended/total >= 0.75, bunkable = floor((attended - 0.75*total)/(1 - 0.75))
// But with remaining classes: let R = remaining, A = attended, T = total
// They can bunk B classes if (A)/(T+R) >= 0.75 ‚Üí but simpler: based on current:
function bunkable(s){
  const { attended, total } = s;
  // classes can skip while staying ‚â•75%: floor((attended - 0.75*total) / 0.75)
  // approximation: how many more bunks allowed
  const val = Math.floor((attended - 0.75 * total) / 0.75);
  return Math.max(val, 0);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function init(){
  const d = new Date();
  document.getElementById('dateInput').value = d.toISOString().split('T')[0];
  document.getElementById('todayLabel').textContent =
    d.toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'});

  // Subject filter dropdown
  const sf = document.getElementById('subjectFilter');
  SUBJECTS.forEach(s=>{
    const o = document.createElement('option');
    o.value = s.id; o.textContent = s.name;
    sf.appendChild(o);
  });
  buildSidebar();
  render();
}

function buildSidebar(){
  const list = document.getElementById('subjectList');
  list.innerHTML = '';
  const btn0 = document.createElement('button');
  btn0.className='subject-item active'; btn0.dataset.sub='';
  btn0.innerHTML=`<div class="sub-dot" style="background:#888"></div><span class="sub-name">All Subjects</span>`;
  btn0.onclick=()=>{ document.getElementById('subjectFilter').value=''; filterBySubject(); updateActiveSub(''); };
  list.appendChild(btn0);

  SUBJECTS.forEach(s=>{
    const b = document.createElement('button');
    b.className='subject-item'; b.dataset.sub=s.id;
    b.innerHTML=`<div class="sub-dot" style="background:${s.color}"></div>
      <span class="sub-name">${s.name}</span>
      <span class="sub-code">${s.code}</span>`;
    b.onclick=()=>{
      document.getElementById('subjectFilter').value=s.id;
      filterBySubject(); updateActiveSub(s.id);
    };
    list.appendChild(b);
  });
}

function updateActiveSub(id){
  document.querySelectorAll('.subject-item').forEach(b=>{
    b.classList.toggle('active', b.dataset.sub === id);
  });
}

function filterBySubject(){
  const v = document.getElementById('subjectFilter').value;
  updateActiveSub(v);
  render();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function render(){
  const q    = document.getElementById('searchInput').value.toLowerCase();
  const dept = document.getElementById('deptFilter').value;
  const sub  = document.getElementById('subjectFilter').value;

  const filtered = students.filter(s=>
    (!q    || s.name.toLowerCase().includes(q) || s.usn.toLowerCase().includes(q)) &&
    (!dept || s.dept === dept) &&
    (!sub  || s.subject === sub)
  );

  // Table
  const tbody = document.getElementById('tableBody');
  if(!filtered.length){
    tbody.innerHTML=`<tr><td colspan="8"><div style="text-align:center;padding:48px;color:var(--muted)">No students found</div></td></tr>`;
  } else {
    tbody.innerHTML = filtered.map((s,i)=>{
      const p   = pct(s);
      const pc  = p>=80?'hi':p>=75?'md':'lo';
      const sub = subjectById(s.subject);
      const bk  = bunkable(s);
      const lowFlag = p < 75;
      return `
      <tr>
        <td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted)">${String(i+1).padStart(2,'0')}</td>
        <td>
          <div class="stu-cell">
            <div class="stu-av" style="background:${avColor(s.id)}18;color:${avColor(s.id)}">${initials(s.name)}</div>
            <div>
              <div class="stu-name">${s.name}</div>
              <div class="stu-id">${s.usn}</div>
            </div>
          </div>
        </td>
        <td>
          <div class="dept-pill" style="color:${DEPT_COLORS[s.dept]||'#333'};background:${DEPT_BG[s.dept]||'#eee'};border-color:${DEPT_COLORS[s.dept]||'#ccc'}40">
            ${s.dept} ¬∑ Sem ${s.sem}
          </div>
        </td>
        <td>
          <span style="font-size:12px;font-weight:600;color:${sub.color};background:${sub.bg};padding:4px 9px;border-radius:6px;">${sub.name}</span>
        </td>
        <td>
          <div class="att-bar-wrap">
            <div class="att-track"><div class="att-fill ${pc}" style="width:${p}%"></div></div>
            <span class="att-pct">${p}%</span>
            ${lowFlag?`<span class="att-warn">LOW</span>`:''}
          </div>
          <div style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'JetBrains Mono',monospace">${s.attended}/${s.total} classes</div>
        </td>
        <td>
          <div class="${bk>0?'shortfall ok':'shortfall'}">${bk>0?`Can skip ${bk} more`:'Cannot bunk!'}</div>
        </td>
        <td>
          <div class="status-grp">
            <button class="st-btn ${s.status==='P'?'sp':''}" onclick="setStatus(${s.id},'P')">P</button>
            <button class="st-btn ${s.status==='A'?'sa':''}" onclick="setStatus(${s.id},'A')">A</button>
            <button class="st-btn ${s.status==='L'?'sl':''}" onclick="setStatus(${s.id},'L')">OD</button>
            <button class="st-btn ${s.status==='M'?'sm':''}" onclick="setStatus(${s.id},'M')">Med</button>
          </div>
        </td>
        <td>
          <button class="icon-btn" onclick="removeStudent(${s.id})" title="Remove">‚úï</button>
        </td>
      </tr>`;
    }).join('');
  }

  updateStats();
  updateAnalytics();
  updateSubtitles(filtered.length);
}

function updateStats(){
  const total   = students.length;
  const present = students.filter(s=>s.status==='P').length;
  const absent  = students.filter(s=>s.status==='A').length;
  const late    = students.filter(s=>s.status==='L').length;
  const med     = students.filter(s=>s.status==='M').length;
  const risk    = students.filter(s=>pct(s)<75).length;
  const f = (n,d)=>d?Math.round(n/d*100)+'%':'‚Äì';

  document.getElementById('stTotal').textContent   = total;
  document.getElementById('stPresent').textContent = present;
  document.getElementById('stAbsent').textContent  = absent;
  document.getElementById('stLate').textContent    = late;
  document.getElementById('stMed').textContent     = med;
  document.getElementById('stPresentPct').textContent = f(present,total);
  document.getElementById('stAbsentPct').textContent  = f(absent,total);
  document.getElementById('stLatePct').textContent    = f(late,total);
  document.getElementById('stMedPct').textContent     = f(med,total);
  document.getElementById('nb-total').textContent     = total;
  document.getElementById('nb-risk').textContent      = risk;
}

function updateAnalytics(){
  // subject-wise
  const sa = document.getElementById('subjectAnalytics');
  sa.innerHTML = SUBJECTS.map(sub=>{
    const group = students.filter(s=>s.subject===sub.id);
    if(!group.length) return '';
    const avgPct = Math.round(group.reduce((a,s)=>a+pct(s),0)/group.length);
    const pc = avgPct>=80?'hi':avgPct>=75?'md':'lo';
    const fillColors = {hi:'var(--present)',md:'var(--late)',lo:'var(--absent)'};
    return `<div class="s-row">
      <div class="s-dot" style="background:${sub.color}"></div>
      <div class="s-info">
        <div class="s-name">${sub.name}</div>
        <div class="s-meta">${group.length} student${group.length!==1?'s':''} ¬∑ ${sub.code}</div>
      </div>
      <div class="s-bar-wrap">
        <div class="s-track"><div class="s-fill" style="width:${avgPct}%;background:${fillColors[pc]}"></div></div>
      </div>
      <div class="s-pct">${avgPct}%</div>
    </div>`;
  }).join('');

  // risk list
  const rl = document.getElementById('riskList');
  const atRisk = students.filter(s=>pct(s)<75).sort((a,b)=>pct(a)-pct(b));
  if(!atRisk.length){
    rl.innerHTML=`<div style="text-align:center;padding:24px;color:var(--present);font-weight:600;font-size:13px">üéâ All students above 75%</div>`;
  } else {
    rl.innerHTML = atRisk.slice(0,8).map(s=>{
      const p   = pct(s);
      const sub = subjectById(s.subject);
      const cls = p < 65 ? 'danger' : 'warn';
      return `<div class="r-row">
        <div>
          <div class="r-name">${s.name}</div>
          <div class="r-sub">${s.usn} ¬∑ ${sub.name}</div>
        </div>
        <span class="r-badge ${cls}">${p}%</span>
      </div>`;
    }).join('');
  }
}

function updateSubtitles(count){
  const d = new Date(document.getElementById('dateInput').value);
  const fmt = d.toLocaleDateString('en-IN',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  document.getElementById('pageSubtitle').textContent = `${fmt} ¬∑ ${count} student${count!==1?'s':''} shown`;
  document.getElementById('tableTitle').textContent = `Student Register`;
  document.getElementById('tableSubtitle').textContent = `${count} records ¬∑ Click P / A / OD / Med to mark attendance`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setStatus(id, status){
  students = students.map(s=>s.id===id?{...s,status}:s);
  render();
  const labels={P:'Present ‚úÖ',A:'Absent ‚ùå',L:'On Duty / Late ‚è∞',M:'Medical Leave üè•'};
  toast(labels[status]||status, 'ok');
}

function markAll(status){
  const sub  = document.getElementById('subjectFilter').value;
  const dept = document.getElementById('deptFilter').value;
  students = students.map(s=>{
    if((!sub || s.subject===sub) && (!dept || s.dept===dept)) return {...s,status};
    return s;
  });
  render();
  toast(`All visible students marked ${status==='P'?'Present':'Absent'}`, status==='P'?'ok':'');
}

function removeStudent(id){
  students = students.filter(s=>s.id!==id);
  render();
  toast('Student removed','');
}

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ
function openModal(){ document.getElementById('overlay').classList.add('open'); }
function closeModal(){ document.getElementById('overlay').classList.remove('open'); }

function addStudent(){
  const name = document.getElementById('mName').value.trim();
  const usn  = document.getElementById('mUSN').value.trim();
  const dept = document.getElementById('mDept').value;
  const sem  = document.getElementById('mSem').value;
  const sub  = document.getElementById('mSubject').value;
  const total    = parseInt(document.getElementById('mTotal').value)||40;
  const attended = parseInt(document.getElementById('mAttended').value)||0;

  if(!name||!usn){ toast('Please fill name and USN','err'); return; }
  if(students.find(s=>s.usn===usn)){ toast('USN already exists!','err'); return; }
  if(attended > total){ toast('Attended cannot exceed total classes','err'); return; }

  students.push({ id:nextId++, name, usn, dept, sem:parseInt(sem), subject:sub, total, attended, status:'P' });
  ['mName','mUSN'].forEach(id=>document.getElementById(id).value='');
  closeModal();
  render();
  toast(`${name} added successfully ‚úÖ`,'ok');
}

// ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ
function exportCSV(){
  const header = 'USN,Name,Department,Semester,Subject,Total Classes,Attended,Attendance %,Today Status';
  const rows = students.map(s=>`${s.usn},"${s.name}",${s.dept},${s.sem},${subjectById(s.subject).name},${s.total},${s.attended},${pct(s)}%,${s.status==='P'?'Present':s.status==='A'?'Absent':s.status==='L'?'On Duty':'Medical'}`);
  const blob = new Blob([[header,...rows].join('\n')],{type:'text/csv'});
  const url  = URL.createObjectURL(blob);
  Object.assign(document.createElement('a'),{href:url,download:'college_attendance.csv'}).click();
  URL.revokeObjectURL(url);
  toast('CSV exported ‚Üì','info');
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function toast(msg, type=''){
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className=`toast ${type} show`;
  clearTimeout(el._t);
  el._t = setTimeout(()=>el.classList.remove('show'),2800);
}

// ‚îÄ‚îÄ EVENT LISTENERS ‚îÄ‚îÄ
document.getElementById('searchInput').addEventListener('input', render);
document.getElementById('deptFilter').addEventListener('change', render);
document.getElementById('subjectFilter').addEventListener('change', render);
document.getElementById('dateInput').addEventListener('change', render);
document.getElementById('overlay').addEventListener('click', e=>{ if(e.target===e.currentTarget) closeModal(); });
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });

init();
</script>
</body>
</html>